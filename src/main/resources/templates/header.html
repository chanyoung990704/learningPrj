<head th:fragment="head-common">
    <meta charset="UTF-8">
    <title th:text="${title} ?: #{title.default}">ì‚¬ì´íŠ¸</title>
    <link rel="stylesheet" th:href="@{/css/style.css}">
    <link rel="stylesheet" th:href="@{/css/error.css}">
    <link rel="stylesheet" th:href="@{/css/login.css}">
    <link rel="stylesheet" th:href="@{/css/register.css}">
    <link rel="stylesheet" th:href="@{/css/post-list.css}">
    <link rel="stylesheet" th:href="@{/css/post-detail.css}">
    <link rel="stylesheet" th:href="@{/css/post-form.css}">
    <link rel="stylesheet" th:href="@{/css/createPostCategory.css}">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;900&display=swap" rel="stylesheet">
</head>

<div class="nav-container" th:fragment="top-banner">
    <nav class="nav-bar">
        <div class="nav-logo">
            <a th:href="@{/}" class="nav-link logo-text">
                <span class="nav-icon">ğŸŒŠ</span> <span class="nav-text" th:text="#{site.name}">MySite</span>
            </a>
        </div>
        <ul class="nav-menu">
            <li><button id="theme-toggle-btn" class="nav-link" type="button" th:title="#{button.theme.toggle.title}" title="í…Œë§ˆ ë³€ê²½">ğŸŒ™</button></li>
            <li th:if="${#authorization.expression('isAuthenticated()') == false}">
                <a class="nav-link" th:href="@{/login}" th:text="#{button.login}">ë¡œê·¸ì¸</a>
            </li>
            <li th:if="${#authorization.expression('isAuthenticated()') == true}">
                <form th:action="@{/logout}" method="post">
                    <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
                    <button type="submit" class="nav-link" th:text="#{button.logout}">ë¡œê·¸ì•„ì›ƒ</button>
                </form>
            </li>
            <li><a class="nav-link" th:href="@{/register}" th:text="#{button.user.register}">íšŒì›ê°€ì…</a></li>
            <li><a class="nav-link" th:href="@{/posts}" th:text="#{button.board}">ê²Œì‹œíŒ</a></li>
        </ul>
    </nav>
</div>

<script th:fragment="theme-script">
document.addEventListener('DOMContentLoaded', function() {
    const root = document.documentElement;
    const btn = document.getElementById('theme-toggle-btn');
    
    if (!btn) return; // ë²„íŠ¼ì´ ì—†ìœ¼ë©´ ì‹¤í–‰í•˜ì§€ ì•ŠìŒ
    
    function setTheme(mode) {
        if (mode === 'dark') {
            root.classList.add('dark');
            btn.textContent = 'â˜€ï¸';
            localStorage.setItem('theme', 'dark');
        } else {
            root.classList.remove('dark');
            btn.textContent = 'ğŸŒ™';
            localStorage.setItem('theme', 'light');
        }
    }
    
    btn.addEventListener('click', function() {
        setTheme(root.classList.contains('dark') ? 'light' : 'dark');
    });
    
    // ì´ˆê¸° í…Œë§ˆ ì ìš©
    const saved = localStorage.getItem('theme');
    if(saved) {
        setTheme(saved);
    } else {
        // ì‚¬ìš©ì ì‹œìŠ¤í…œ ì„¤ì •ì— ë”°ë¼ ê¸°ë³¸ í…Œë§ˆ ì„¤ì •
        if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
            setTheme('dark');
        }
    }
});
</script>
