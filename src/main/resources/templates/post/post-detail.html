<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <title th:text="${post.title}">Post Detail</title>
  <link rel="stylesheet" th:href="@{/css/style.css}">
  <link rel="stylesheet" th:href="@{/css/post-detail.css}">
</head>
<body>
<!-- 헤더 포함 -->
<div th:replace="~{header :: .top-banner}"></div>

<div class="post-detail-container">
  <!-- 게시글 제목 -->
  <h1 class="post-title" th:text="${post.title}">Sample Title</h1>

  <!-- 게시글 정보 -->
  <div class="post-info">
    <span class="category" th:text="${post.category.getName()}">Category</span>
    <span class="author" th:text="${post.author}">Author Name</span>
    <span class="time" th:text="${#temporals.format(post.time, 'yyyy.MM.dd HH:mm')}">21:15</span>
  </div>

  <!-- 게시글 내용 -->
  <div class="post-content" th:utext="${post.content}">
    <p>Sample content goes here...</p>
  </div>

  <!-- 게시글 액션 버튼 -->
  <div class="post-actions">
    <a th:href="@{/posts}" class="btn btn-secondary">목록으로</a>
    <!-- 작성자만 수정/삭제 가능 (옵션) -->
    <div th:if="${#authorization.expression('isAuthenticated()') && post.author == #authentication.name}" class="author-actions">
      <a th:href="@{/posts/{id}/edit(id=${post.id})}" class="btn btn-edit">수정</a>
      <form th:action="@{/posts/{id}/delete(id=${post.id})}" method="post" style="display:inline;">
        <button type="submit" class="btn btn-delete" onclick="return confirm('정말 삭제하시겠습니까?')">삭제</button>
      </form>
    </div>
  </div>

  <!-- 댓글 섹션 -->
  <div class="comments-section">
    <h2>Comments <span class="comments-count" th:text="${#lists.size(comments)}">0</span></h2>

    <!-- 댓글이 없는 경우 -->
    <div class="no-comments" th:if="${#lists.isEmpty(comments)}">
      <p>아직 댓글이 없습니다. 첫 댓글을 작성해보세요!</p>
    </div>

    <!-- 댓글 목록 -->
    <ul class="comments-list" th:if="${!#lists.isEmpty(comments)}">
      <li th:each="comment : ${comments}" class="comment-item">
        <div class="comment-header">
          <span class="comment-author" th:text="${comment.author}">Commenter Name</span>
          <span class="comment-time" th:text="${#temporals.format(comment.time, 'yyyy.MM.dd HH:mm')}">21:20</span>
        </div>
        <div class="comment-content" th:text="${comment.content}">Sample comment content...</div>
      </li>
    </ul>
  </div>

  <!-- 댓글 작성 폼 (로그인 사용자만 표시) -->
  <div class="comment-form" th:if="${#authorization.expression('isAuthenticated()')}">
    <h3>Write a Comment</h3>
    <form th:action="@{/posts/{id}/comments(id=${post.id})}" method="post" th:object="${commentToPostRequestDTO}">
      <!-- 댓글 내용 -->
      <textarea name="content" placeholder="Write your comment here..." required th:field="*{content}"></textarea>

      <!-- 제출 버튼 -->
      <button type="submit" class="btn comment-submit-btn">등록</button>
    </form>
  </div>

  <!-- 로그인 안내 메시지 (비로그인 사용자에게 표시) -->
  <div class="login-prompt" th:if="${!#authorization.expression('isAuthenticated()')}">
    <p>댓글을 작성하려면 <a th:href="@{/login}">로그인</a>이 필요합니다.</p>
  </div>
</div>

<!-- 푸터 포함 -->
<div th:replace="~{footer :: .footer}"></div>
</body>
</html>
